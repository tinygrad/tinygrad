Make libnir visible:
sed -i '/gnu_symbol_visibility/d' src/compiler/nir/meson.build
Make libcompiler visible:
sed -i '/gnu_symbol_visibility/d' src/compiler/meson.build

Fix rpath:
patchelf --add-rpath $MESA_PREFIX/lib/x86_64-linux-gnu $MESA_PREFIX/lib/x86_64-linux-gnu/libvulkan_nouveau.so

LD_LIBRARY_PATH=$MESA_PREFIX/lib/x86_64-linux-gnu OCL_ICD_VENDORS="$MESA_PREFIX/etc/OpenCL/vendors/" \
  RUSTICL_ENABLE=swrast RUSTICL_DEBUG=nir MESA_SHADER_CACHE_DISABLE=true DISABLE_COMPILER_CACHE=1 GPU=1 \
  python3 -c "from tinygrad import Tensor; print((Tensor.eye(1,1) * 2).numpy())"

Generate NIR options for NAK:
cc nak_nir_options.c -o nak_nir_options \
  -DHAVE_ENDIAN_H -DHAVE_PTHREAD -DHAVE_STRUCT_TIMESPEC \
  -I$MESA_SRC/src -I$MESA_SRC/include -I$MESA_SRC/gen
./nak_nir_options | gzip | base64 -w 0

NAK intrinsics:

nir_intrinsic_al2p_nv
nir_intrinsic_as_uniform
nir_intrinsic_convert_alu_types
nir_intrinsic_ballot
nir_intrinsic_bar_break_nv
nir_intrinsic_bar_set_nv
nir_intrinsic_bar_sync_nv
nir_intrinsic_suclamp_nv
nir_intrinsic_subfm_nv
nir_intrinsic_sueau_nv
nir_intrinsic_imadsp_nv
nir_intrinsic_suldga_nv
nir_intrinsic_bindless_image_load
nir_intrinsic_bindless_image_sparse_load
nir_intrinsic_sustga_nv
nir_intrinsic_bindless_image_store
nir_intrinsic_copy_fs_outputs_nv
nir_intrinsic_demote
nir_intrinsic_demote_if
nir_intrinsic_global_atomic
nir_intrinsic_global_atomic_swap
nir_intrinsic_ipa_nv
nir_intrinsic_isberd_nv
nir_intrinsic_vild_nv
nir_intrinsic_load_barycentric_at_offset_nv
nir_intrinsic_load_barycentric_centroid
nir_intrinsic_load_barycentric_pixel
nir_intrinsic_load_barycentric_sample
nir_intrinsic_ldtram_nv
nir_intrinsic_load_sample_id
nir_intrinsic_load_sample_mask_in
nir_intrinsic_load_tess_coord_xy
nir_intrinsic_load_scratch
nir_intrinsic_load_shared
nir_intrinsic_load_shared_lock_nv
nir_intrinsic_load_sysval_nv
nir_intrinsic_ldc_nv
nir_intrinsic_ldcx_nv
nir_intrinsic_pin_cx_handle_nv
nir_intrinsic_unpin_cx_handle_nv
nir_intrinsic_barrier
nir_intrinsic_reduce
nir_intrinsic_shared_atomic
nir_intrinsic_shared_atomic_swap
nir_intrinsic_ssa_bar_nv
nir_intrinsic_store_global
nir_intrinsic_fs_out_nv
nir_intrinsic_store_scratch
nir_intrinsic_store_shared
nir_intrinsic_store_shared_unlock_nv
nir_intrinsic_final_primitive_nv
nir_intrinsic_is_sparse_texels_resident
nir_intrinsic_cmat_muladd_nv
