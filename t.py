from tinygrad.uop.ops import UOp, Ops, dtypes, KernelInfo, AxisType
from tinygrad.device import Device
from tinygrad.engine.realize import get_program

c0 = UOp(Ops.DEFINE_GLOBAL, dtypes.float.ptr(25600), (), 0)
c2 = UOp.range(5, 2, AxisType.LOOP)
c4 = UOp.range(5, 3, AxisType.LOOP)
c7 = UOp.range(32, 1, AxisType.LOOP)
c11 = UOp.range(32, 0, AxisType.LOOP)
c14 = c2*UOp.const(dtypes.index, 5)+c4+c7*UOp.const(dtypes.index, 25)+c11*UOp.const(dtypes.index, 800)
c17 = c11<UOp.const(dtypes.index, 16)
c18 = UOp(Ops.DEFINE_GLOBAL, dtypes.uint.ptr(1), (), 1)
c20 = c18.index(UOp.const(dtypes.index, 0))
c24 = c20+(c14+UOp.const(dtypes.index, 1)).cast(dtypes.uint)
c34 = UOp(Ops.DEFINE_GLOBAL, dtypes.uint.ptr(2), (), 2)
c40 = c34.index(UOp.const(dtypes.index, 1)).cast(dtypes.ulong)*UOp.const(dtypes.ulong, 4294967296)|c34.index(UOp.const(dtypes.index, 0)).cast(dtypes.ulong)
c44 = c17.where(((c24+UOp.const(dtypes.uint, -12801)).cast(dtypes.ulong)*UOp.const(dtypes.ulong, 4294967296)|(c24+UOp.const(dtypes.uint, -25601)).cast(dtypes.ulong)).threefry(c40).cast(dtypes.uint), UOp.const(dtypes.uint, 0))
c48 = c20+(c14+UOp.const(dtypes.index, -12799)).cast(dtypes.uint)
c58 = c17.where(UOp.const(dtypes.uint, 0), (((c48+UOp.const(dtypes.uint, -12801)).cast(dtypes.ulong)*UOp.const(dtypes.ulong, 4294967296)|(c48+UOp.const(dtypes.uint, -25601)).cast(dtypes.ulong)).threefry(c40)//UOp.const(dtypes.ulong, 4294967296)).cast(dtypes.uint))
c66 = ((c44+c58)//UOp.const(dtypes.uint, 512)|UOp.const(dtypes.uint, 1065353216)).bitcast(dtypes.float)+UOp.const(dtypes.float, -1.0)
c68 = c0.index(c14, ptr=True).store(c66).end(c11, c7, c2, c4)
ast = c68.sink(arg=KernelInfo(name='test', axis_types=(), dont_use_locals=False, applied_opts=(), opts_to_apply=None))
prg = get_program(ast, Device["AMD"].renderer)
lib = Device["AMD"].compiler.compile(prg.src)
Device["AMD"].compiler.disassemble(lib)
